{% extends 'WebProfilerBundle:Profiler:base.html.twig' %}

{% block body %}

    <div id="content" style="margin-bottom: 20px;">
        {% include 'WebProfilerBundle:Profiler:header.html.twig' only %}

        <div id="main">

            <div class="clear_fix">
                <div id="collector_wrapper">
                    {% if profile %}
                        <div id="resume">
                            <a id="resume-view-all" href="{{ path('_profiler_search', {limit: 10}) }}">View all</a>
                            <strong>Profile for:</strong>
                            {{ profile.method|upper }}
                            {% if profile.method|upper in ['GET', 'HEAD'] %}
                                <a href="{{ profile.url }}">{{ profile.url }}</a>
                            {% else %}
                                {{ profile.url }}
                            {% endif %}
                            <span class="date">
                                <em>by {{ profile.ip }}</em> at <em>{{ profile.time|date('r') }}</em>
                            </span>
                        </div>
                    {% endif %}

                    <div id="collector_content">
                        {% include 'WebProfilerBundle:Profiler:base_js.html.twig' %}
                        {% block panel '' %}
                    </div>
                </div>
                <div id="navigation">
                    {% if templates is defined %}
                        <ul id="menu_profiler">
                            {% for name, template in templates %}
                                {% set menu %}{{ template.renderBlock('menu', { 'collector': profile.getcollector(name)}) }}{% endset %}
                                {% if menu != '' %}
                                    <li class="{{ name }}{% if name == panel %} selected{% endif %}">
                                        <a href="{{ path('_profiler', { 'token': token, 'panel': name }) }}">{{ menu|raw }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            <li class="minimize">
                                <a href="javascript:void(0);" title="Minimize toolbar" onclick="return minimizeLeftPanels();">
                                    <span class="label">
                                        <span class="icon"><img id="minimizePanelIcon" src="{{ asset('bundles/webprofiler/images/profiler/up-arrow.png') }}" alt="" /></span>
                                        <strong>Minimize</strong>
                                    </span>
                                </a>
                            </li>
                        </ul>
                    {% endif %}
                    {% render 'WebProfilerBundle:Profiler:searchBar' %}
                    {% include 'WebProfilerBundle:Profiler:admin.html.twig' with { 'token': token } only %}
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">//<![CDATA[

        function setCookie(name, value, timeout) {
            var exdate=new Date();
            exdate.setDate(exdate.getDate() + timeout);
            value = value + ((timeout==null) ? "" : "; expires="+exdate.toUTCString());

            document.cookie = name + "=" + value;
        }

        function getCookie(name) {
            var i, x, y, cookies = document.cookie.split(";");

            for (i=0;i<cookies.length;i++) {
                x = cookies[i].substr(0,cookies[i].indexOf("="));
                y = cookies[i].substr(cookies[i].indexOf("=")+1);
                x = x.replace(/^\s+|\s+$/g,"");
                if (x == name) {
                    return y;
                }
            }

            return null;
        }

        function minimizeLeftPanels() {
            var upIconPath = "{{ asset('bundles/webprofiler/images/profiler/up-arrow.png') }}",
                downIconPath = "{{ asset('bundles/webprofiler/images/profiler/down-arrow.png') }}",
                menuItems = document.getElementById('menu_profiler').getElementsByTagName('LI'),
                displayState = 'none',
                elem;

            if (document.getElementById('minimizePanelIcon').src.indexOf('up-arrow.png') != -1) {
                document.getElementById('navigation').style.width = '60px';
                document.getElementById('resume').style.marginLeft = '60px';
                document.getElementById('collector_content').style.marginLeft = '0px';
                document.getElementById('minimizePanelIcon').src = downIconPath;
                displayState = 'none';
            } else {
                document.getElementById('navigation').style.width = '250px';
                document.getElementById('resume').style.marginLeft = '250px';
                document.getElementById('collector_content').style.marginLeft = '250px';
                document.getElementById('minimizePanelIcon').src = upIconPath;
                displayState = 'block';
            }

            document.getElementById('searchBar').style.display = displayState;
            document.getElementById('adminBar').style.display = displayState;

            for (elem in menuItems) {
                if (elem != menuItems.length - 1) {
                    if (typeof(menuItems[elem].style) != 'undefined') {
                        menuItems[elem].style.display = displayState;
                    }
                } else {
                    if (displayState == 'none') {
                        menuItems[elem].style.borderTopLeftRadius = '16px';
                        menuItems[elem].children[0].title = 'Restore toolbar';
                    } else {
                        menuItems[elem].style.borderTopLeftRadius = '0px';
                        menuItems[elem].children[0].title = 'Minimize toolbar';
                    }

                }

                if (typeof(menuItems[elem].getElementsByClassName) !='undefined' &&
                    menuItems[elem].getElementsByClassName('count').length > 0) {
                    menuItems[elem].getElementsByClassName('count')[0].style.display = displayState;
                }
            }

            setCookie('sf2_profiler_leftmenu', displayState, 365);

            try {
                canvasAutoUpdateOnThresholdChange(null);
            } catch (err) {

            }

            return false;
        }

        window.setTimeout(function() {
            var menuItems = document.getElementById('menu_profiler').getElementsByTagName('LI'),
                elem, value, child;

            if (getCookie('sf2_profiler_leftmenu') != null) {
                if (getCookie('sf2_profiler_leftmenu') == 'none') {
                    minimizeLeftPanels();
                }
            }

            for (elem in menuItems) {
                if (typeof(menuItems[elem].children) != 'undefined' &&
                    menuItems[elem].children.length > 0) {
                    child = menuItems[elem].children[0]

                    if (child.getAttribute('title') == '' ||
                        child.getAttribute('title') == null) {
                        value = child.text.replace(/^\s+/g, '').split('\n')[0].replace(/\s+$/g, '');
                        child.setAttribute('title', value);
                    }
                }
            }
        }, 25);

    //]]></script>
{% endblock %}
